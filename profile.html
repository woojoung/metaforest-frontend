<!DOCTYPE html>
<html lnag="ko">

<head>
    <meta charset="UTF-8">
    <title>메타포레스트 : 내 정보</title>

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link href="fonts/NexonLv2Gothic/nexonlv2gothic.css" rel="stylesheet">
    <link href="fonts/ProximaNova/proximanova.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=DM+Sans:400,400i,500,700&family=Raleway:wght@800&display=swap' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <!-- css-->
    <link rel="stylesheet" href="css/account.css">
    <link rel="stylesheet" href="css/custom.css">

</head>

<body>
    <!-- header -->
    <div id="header">
        <h2 id="logo"><a href="" target="_blank" title=""><img src="/img/logo/logo_bk.png"></a>
        </h2>
    </div>

    <!-- wrapper -->
    <div id="wrapper">

        <!-- content-->
        <div class="contentBox" id="content">
            <h3 class="headline1">내 정보</h3>

            <!-- PARTNER ID -->
            <div>
                <label for="partnerId">기관 아이디</label>
                <span class="box int_pid">
                    <input type="text" id="pid" class="int" maxlength="20" placeholder="기관" required>
                </span>
            </div>
            <!-- PARTNER NAME -->
            <!-- <div>
                <label for="partnerNickname">기관 이름</label>
                <span class="box int_pid">
                    <input type="text" id="pName" class="int" maxlength="20" placeholder="기관" required>
                </span>
            </div> -->

            <!-- NAME -->
            <div>
                <label for="userNickname">이름</label>
                <span class="box int_name">
                    <input type="text" id="name" class="int" maxlength="100" placeholder="이름" required>
                </span>
            </div>

            <!-- ACCOUNT ID -->
            <div>
              <label for="accountId">아이디</label>
              <span class="box int_aid">
                  <input type="text" id="aid" class="int" maxlength="20" placeholder="아이디" required>
              </span>
            </div>

            <!-- PASSWORD -->
            <div>
                <label for="password">비밀번호</label>
                <span class="box int_password">
                    <input type="password" id="password" class="int" maxlength="100" placeholder="비밀번호" required>
                </span>
                <div class="">
                    <button type="button" id="" style="background-color: white;">
                        <span style="color: blue;">비밀번호 변경하기</span>
                    </button>
                </div>
            </div>

            <!-- MOBILE -->
            <div>
              <label for="mobile">모바일</label>
              <span class="box int_uid">
                  <input type="text" id="uid" class="int" maxlength="20" placeholder="010-1234-1234" required>
              </span>
            </div>

            <!-- EMAIL -->
            <div>
                <label for="email">이메일 주소</label>
                <span class="box int_email">
                    <input type="text" id="email" class="int" maxlength="100" placeholder="이메일" required>
                </span>
                <span class="error_next_box">이메일 주소를 다시 확인해주세요.</span>
            </div>

            <!-- FIND BTN-->
            <div class="">
                <button type="button" id="" style="background-color: white;">
                    <span style="color: red;">계정탈퇴</span>
                </button>
            </div>

            <!-- FIND BTN-->
            <div class="btn_area" onClick="onSubmitForm()" >
                <button type="button" id="btnFind">
                    <span>저장하기</span>
                </button>
            </div>

        </div>
        <!-- content-->

    </div>
    <!-- wrapper -->

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">

        <div class="footer-top">
            <div class="footer-left">
            <div class="logo">
                <img class="logo" src="img/logo/log03.png" alt="logo">
            </div>
            </div>
            <div class="footer-right">
            </div>
        </div>

        <div class="footer-middle">
            <div class="btn-download">
            <img src="img/button/btn-download.png" alt="download">
            </div>
        </div>

        <div class="footer-bottom">
            <div>
            <div class="footer-info">
                <ul>
                <li>주식회사 야타브엔터 (<a href="http://www.yatavent.com" target="_blank">www.yatavent.com</a>)</li>
                <li>주소 | 서울특별시 성동구 뚝섬로17가길 48</li>
                <li>Mail | yatavent@yatavent.com</li>
                <li>Tel | 02-2039-00633</li>
                <li>사업자등록번호 | 750-88-01121</li>
                </ul>
            </div>

            <div class="footer-copyright">
                <span class="copyright">
                Copyright &copy; <a href="http://www.yatavent.com" target="_blank">YATAVENT</a>
                Corp. All rights reserved.
                </span>
            </div>
            </div>
            
            <div class="footer-socials">
            <div>
                <a href="https://www.instagram.com/metaforest.official/?hl=ko" target="_blank" class="social-instagram"
                aria-label="instagram" title="instagram" target="_blank">
                <i class="fa fa-instagram" aria-hidden="true"></i>
                </a>
            </div>
            <div>
                <a href="https://www.instagram.com/metaforest.official/?hl=ko" class="social social-blog" target="_blank"
                aria-label="blog" title="blog" target="_blank">
                <i class="fa fa-blog"></i>
                </a>
            </div>
            <div>
                <a href="https://www.facebook.com/profile.php?id=100075394868765" target="_blank" class=" social-facebook"
                aria-label="facebook" title="facebook" target="_blank">
                <i class="fa fa-facebook" aria-hidden="true"></i>
                </a>
            </div>
            <div class="contact">
                <span></span>
                <a href="http://yatavent.com/contact">Contact</a>
            </div>
            </div>
            
        </div>

        </div> <!-- end container -->
    </footer> <!-- end footer -->
    
    <script src='./tools/cfg.js'></script>
    <script src='./tools/enums.js'></script>
    <script src='./tools/libs.js'></script>
    <script src='./tools/md5.js'></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
      'use strict'
      window.onload = function () {
        // apiGetOne()
      }
      const apiGetOne = async () => {
        try {
          const _response = await axios.post(apiUrl +'user', {
            msgType: eApiMessageType.USER_GET_ONE_INFO_REQ,
            data: {
              userId: 1 // from localStorage or params
            }
          }, {withCredentials: true})
    
          let response = {}
          Object.assign(response, _response.data)
    
          console.log(response)
          console.log(response.data)
    
        } catch (err) {
          console.error(err)
        }
      };
    
    </script>

    <script>
        'use strict'
        async function onSubmitForm() {
            let partnerId = document.getElementById("pid").value
            let userNickname = document.getElementById("name").value
            let accountId = document.getElementById("aid").value
            let password = document.getElementById("password").value
            let mobile = document.getElementById("uid").value
            let email = document.getElementById("email").value
            let passwd = document.getElementById("formPasswordInput2").value

            if (email === "" && passwd === "") {
                alert("항목을 모두 입력해주세요.")
                return
            }

            const hexMd5 = hex_md5(accountId + hex_md5(passwd))
            const md5Mobile = hex_md5('metaforest:' + hex_md5(mobile))
            let apiRequest = {
                msgType: eApiMessageType.USER_UPDATE_REQ,
                data: {
                    userNickname: userNickname,
                    profileImageUrl: '',
                    accountId: accountId,
                    email: email,
                    password: hexMd5,
                    md5Mobile: md5Mobile,
                    partnerId: partnerId
                }

            }

            const _response = await axios.post(apiUrl+'user', apiRequest, {withCredentials: true})

            let response = {}
            Object.assign(response, _response.data)

            // console.log(response)
            // console.log(response.data)
            // console.log(response.data.accessLevel)

            if (response.status !== 200) {
                alert(response.message) 
                return
            }
            storageSet('accessLevel', response.data.accessLevel.toString())
            location.href = "./board_main.html"
        }
    </script>

</body>
</html>