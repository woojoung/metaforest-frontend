<!DOCTYPE html>
<html lnag="ko">

<head>
    <meta charset="UTF-8">
    <title>메타포레스트 : 회원가입</title>

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link href="fonts/NexonLv2Gothic/nexonlv2gothic.css" rel="stylesheet">
    <link href="fonts/ProximaNova/proximanova.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=DM+Sans:400,400i,500,700&family=Raleway:wght@800&display=swap'
        rel='stylesheet'>

    <!-- css-->
    <link rel="stylesheet" href="css/signup.css">

</head>

<body>
    <!-- header -->
    <div id="header">
        <h2 id="logo"><a href="" target="_blank" title=""><img src="/img/logo/logo_bk.png"></a>
        </h2>
    </div>


    <!-- wrapper -->
    <div id="wrapper">

        <!-- content-->
        <div id="content">

            <!-- ID -->
            <div>
                <h3 class="join_title">
                    <label for="id">아이디</label>
                </h3>
                <span class="box int_id">
                    <input type="text" id="id" class="int" maxlength="20">

                </span>
                <span class="error_next_box"></span>
            </div>

            <!-- PW1 -->
            <div>
                <h3 class="join_title"><label for="pswd1">비밀번호</label></h3>
                <span class="box int_pass">
                    <input type="text" id="pswd1" class="int" maxlength="20">
                    <span id="alertTxt">사용불가</span>
                </span>
                <span class="error_next_box"></span>
            </div>

            <!-- PW2 -->
            <div>
                <h3 class="join_title"><label for="pswd2">비밀번호 재확인</label></h3>
                <span class="box int_pass_check">
                    <input type="text" id="pswd2" class="int" maxlength="20">
                </span>
                <span class="error_next_box"></span>
            </div>

            <!-- NAME -->
            <div>
                <h3 class="join_title"><label for="name">이름</label></h3>
                <span class="box int_name">
                    <input type="text" id="name" class="int" maxlength="20">
                </span>
                <span class="error_next_box"></span>
            </div>


            <!-- GENDER -->
            <div>
                <h3 class="join_title"><label for="gender">성별</label></h3>
                <span class="box gender_code">
                    <select id="gender" class="sel">
                        <option>선택</option>
                        <option value="M">남자</option>
                        <option value="F">여자</option>
                    </select>
                </span>
                <span class="error_next_box">필수 정보입니다.</span>
            </div>

            <!-- BIRTH -->
            <div>
                <h3 class="join_title"><label for="yy">생년월일</label></h3>

                <div id="bir_wrap">
                    <!-- BIRTH_YY -->
                    <div id="bir_yy">
                        <span class="box">
                            <input type="text" id="yy" class="int" maxlength="4" placeholder="년(4자)">
                        </span>
                    </div>

                    <!-- BIRTH_MM -->
                    <div id="bir_mm">
                        <span class="box">
                            <input type="text" id="mm" class="int" maxlength="2" placeholder="월">
                        </span>
                    </div>

                    <!-- BIRTH_DD -->
                    <div id="bir_dd">
                        <span class="box">
                            <input type="text" id="dd" class="int" maxlength="2" placeholder="일">
                        </span>
                    </div>

                </div>
                <span class="error_next_box"></span>
            </div>


            <!-- EMAIL -->
            <div>
                <h3 class="join_title"><label for="email">이메일 주소</label></h3>
                <span class="int_email">
                    <input type="text" id="email" class="int" maxlength="100" placeholder="">
                    @
                    <select name="" id="email_addrs">
                        <option value="">직접입력</option>
                        <option value="gmail.com">gmail.com</option>
                        <option value="hanmail.net">hanmail.net</option>
                        <option value="hotmail.com">hotmail.com</option>
                        <option value="nate.com">nate.com</option>
                        <option value="naver.com">naver.com</option>
                        <option value="yahoo.com">yahoo.com</option>
                    </select>
                </span>
                <div id="email_btn">
                    <button type="button" id="btnSend" onclick="requestAuthCode()">
                        <span>인증번호 요청</span>
                    </button>
                </div>
                <span class="error_next_box">이메일 주소를 다시 확인해주세요.</span>
            </div>

            <!-- SECURITY CODE -->
            <div>
                <h3 class="join_title"><label for="email_code">인증번호 (5자리)</label></h3>
                <span class="int_code">
                    <input type="text" id="email_code" class="int" maxlength="5" placeholder="인증번호 입력하세요">
                </span>
                <div id="code_btn">
                    <button type="button" id="btnSend" onclick="verifyAuthCode()">
                        <span>확인</span>
                    </button>
                </div>
            </div>



            <!-- MOBILE -->
            <!-- <div>
                <h3 class="join_title"><label for="phoneNo">휴대전화</label></h3>
                <span class="box int_mobile">
                    <input type="tel" id="mobile" class="int" maxlength="16" placeholder="대한민국 +82" readonly="true">
                </span>
                </br>
                <div id="mobile_wrap">
                    <div id="mobile_digit">
                        <span class="box int_mobile">
                            <input type="tel" id="mobile" class="int" maxlength="16" placeholder="전화번호 입력">
                        </span>
                        <span class="error_next_box"></span>
                    </div>
                    <div id="mobile_btn">
                        <button type="button" id="btnSend">
                            <span>인증번호 받기</span>
                        </button>
                    </div>
                </div>
            </div> -->


            <!-- JOIN BTN-->
            <div class="btn_area">
                <button type="button" id="btnJoin" onclick="onSubmitForm()">
                    <span>가입하기</span>
                </button>
            </div>

            
        </div>
        <!-- content-->

    </div>
    <!-- wrapper -->
    <script src="main.js"></script>
    <script src='./tools/cfg.js'></script>
    <script src='./tools/enums.js'></script>
    <script src='./tools/libs.js'></script>
    <script src='./tools/md5.js'></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        'use strict'
        async function verifyAuthCode() {
            let storageAuthCode = storageGet('authCode', '0')
            let emailAuthCode = document.getElementById("email_code").value

            if (storageAuthCode != emailAuthCode) {
                alert("storageAuthCode != emailAuthCode")
                return
            }


            alert('인증번호 확인')
        }
    </script>

    <script>
        'use strict'
        async function requestAuthCode() {
            let email = document.getElementById("email").value
            let emailAddress = document.getElementById("email_addrs")
            let emailAddressValue = emailAddress.options[emailAddress.selectedIndex].value

            if (email === "") {
                alert("email === ''")
                return
            }

            if (emailAddressValue === "") {
                alert("emailAddressValue === ''")
                return
            }

            const sendEmail = [email, emailAddressValue].join('@')

            if (!emailCheck(sendEmail)) {
                alert("wrong email address")
                return
            }

            let apiRequest = {
                msgType: eApiMessageType.USER_SIGNUP_AUTHCODE_REQ,
                data: {
                    email: sendEmail,
                }
            }

            const _response = await axios.post('http://127.0.0.1:7071/auth/signup', apiRequest, {
                withCredentials: true
            })

            let response = {}
            Object.assign(response, _response)

            console.log(response)
            console.log(response.data)

            storageSet('authCode', response.data.authCode)
        }
    </script>

    <script>
        'use strict'
        async function onSubmitForm() {
            let accountId = document.getElementById("id").value
            let userNickname = document.getElementById("name").value

            let email = document.getElementById("email").value
            let emailAddress = document.getElementById("email_addrs")
            let emailAddressValue = emailAddress.options[emailAddress.selectedIndex].value

            let gender = document.getElementById("gender")
            let genderValue = gender.options[gender.selectedIndex].value

            let passwd = document.getElementById("pswd1").value
            let passwd2 = document.getElementById("pswd2").value

            let birthYear = document.getElementById("yy").value
            let birthMonth = document.getElementById("mm").value
            let birthDay = document.getElementById("dd").value

            if (email === "" && passwd === "" && userNickname === "" && passwd2 === "") {
                alert("email === '' && passwd === '' && userNickname === '' && passwd2 === ''")
                return
            }

            const sendEmail = [email, emailAddressValue].join('@')
            const birth = [birthYear, birthMonth, birthDay].join('-')

            if (!emailCheck(sendEmail)) {
                alert("wrong email address")
                return
            }

            // md5 passwd 
            if (passwd !== passwd2) {
                alert("passwd !== passwd2")
                return
            }

            const hexMd5 = hex_md5(sendEmail + hex_md5(passwd))

            let apiRequest = {
                msgType: eApiMessageType.USER_SIGNUP_REQ,
                data: {
                    accountId: accountId,
                    userNickname: userNickname,
                    profileImageUrl: '',
                    email: sendEmail,
                    password: hexMd5,
                    gender: genderValue,
                    birth: birth,
                    md5Mobile: ''
                }
            }

            const _response = await axios.post('http://127.0.0.1:7071/auth/signup', apiRequest, {
                withCredentials: true
            })

            let response = {}
            Object.assign(response, _response)

            console.log(response)
            console.log(response.data)

            // if (response.errCode !== eErrCode.NONE) {
            //     alert(response.message) 
            //     return
            // }
            // window.location.href = "https://metaforest.us/login.html"
            window.location.href = "http://127.0.0.1:5500/login.html"
        }
    </script>
</body>

</html>